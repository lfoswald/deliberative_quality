---
title: "Deliberative Wildfire Networks"
author: "Lisa F. Oswald"
date: "`r format(Sys.time(), '%B %d, %Y | %H:%M:%S | %Z')`"
output: 
  html_document:
    toc: FALSE
    number_sections: FALSE
    highlight: tango
    theme: cosmo
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      eval = TRUE,
                      error = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      comment = NA)
```

Comments were collected using the PRAW, a Python wrapper for a Reddit API. The comment text was collected together with the reply-to structure (identified through comment ids and parent-ids). Using this procedure, a network structure of nodes (comments) and edges (reply-to-structure) was constructed.
Discussion (sub)threads were identified using the network metric of weakly connected components. Within one API call, PRAW collects either comments or submissions, not both belonging together, therefore these discussion threads are considered as sub-treads, starting with root comments, comments directly commenting a reddit submission or post. 
<br>
Another API call using PRAW collected the submissions that triggered the root-comments. They were traced back using the parent-id of the root comments. In other words, the mothers for all the small comment threads had to be identified in order to merge sibling-threads, belonging to one original trigger-mother-submission, together.
<br>
These trigger submissions were manually coded with qualitative content analysis. A code of 1 indicates content that expresses skepticism about the relationship between climate change and wildfires, while a code of 0 indicates the opposite: concern about this very relation. A code of 2 indicates that the content does not directly relate to wildfires but that e.g. the word "fire" was used in a metaphorical way (e.g. "Someone is on fire."). The following tables display the summary statistics for the discussion thread characteristics of the whole threads, the sub-treads and the comments. 
<br>
In a manual step, the thread / sub-thread matching was checked. 


```{r}
## Data preparation 

library(tidyverse)
library(ggplot2)
library(readr)
library(readxl)
library(xtable)
library(knitr)
library(kableExtra)
library(writexl)

data_cc_networks <- read_excel("data_cc_networks_coded.xlsx")

## get depth metric for overall (big) thread

data_cc_networks <- data_cc_networks %>%
  group_by(id_sub)%>%
  mutate(thread_depth = max(depths))

## get with metric for overall (big) thread

data_cc_networks <- data_cc_networks %>%
  group_by(id_sub)%>%
  mutate(thread_width = max(widths))

## compress data set to trigger submissions only

threads <- data_cc_networks%>%
  filter(type_sub != "is.na")

## load comment level data
reddit_df_indegree <- read_csv("reddit_df_indegree_thread_id.csv")

## merge comment data with trigger submissions

fire_data <- merge(x = threads, y = reddit_df_indegree, by.x = "id_rc", by.y = "id" , all = TRUE)

fire_data <- fire_data%>%
  group_by(subreddit, wave.y)%>%
  arrange(thread_id)

# help with sorting subthreads to submissions

fire_data <- fire_data%>%
  group_by(subreddit_y, wave.y, thread_id)%>%
  mutate(sub_thread_id = group_indices())

#write_xlsx(fire_data,"fire_data.xlsx")

# manual match contolling & thread sorting

#### creating final dataset #####
data <- read_excel("fire_data_clean.xlsx")

# opposing variables 
data <- data%>%
  mutate(opposing = ifelse((type_sub == 1 & subreddit == "climatechange"), 1, 
                    ifelse((type_sub == 0 & subreddit == "climateskeptics"), 1, 0)))

write_xlsx(data,"data_fire_cc.xlsx")

```

## Sample
```{r, results=FALSE}
data <- read_excel("data_fire_cc.xlsx")

#data <- data.frame(na.omit(data))

data <- data%>%
  mutate(type_sub = recode(type_sub, "3" = 1))

# 1543 comments
length(unique(data$id_c))

# written by 572 unique authors
length(unique(data$author_c))

# 524 sub-threads
length(unique(data$thread_id))

# 115 threads
length(unique(data$id_sub))

# 62 unique authors writing the submissions
length(unique(data$author_sub))

#### opposing content #####
opposing_data <- data%>%
  filter(opposing == 1)

# 168 / 1543 opposing comments
length(unique(opposing_data$id_c))
# written by 93 authors
length(unique(opposing_data$author_c))

# 86 / 524 sub-threads
length(unique(opposing_data$thread_id))

# 21 / 115 threads
length(unique(opposing_data$id_sub))
# written by 16 authors
length(unique(opposing_data$author_sub))

# unrelated comments 
table(data$type_sub)

thread_data <- data %>% 
  group_by(id_sub) %>% slice(1)

table(thread_data$type_sub)

```
#### NAs kept
The final dataset consists of 1543 comments, written by written by 572 different authors. These comments belong to 524 sub-threads and 115 threads. The trigger submission for the 115 threads were written by 62 unique authors. 168 out of the 1543 comments followed 21 submissions with opposing content relative to the subreddit's mainstream content. These opposing submission were written by 16 different authors. In total, 7 threads did not contain discussions on the 2020 wildfires but e.g. used the word 'fire' in a metaphorical way. They were excluded from the analyses.

#### NAs removed
The final dataset consists of 1404 comments, written by written by 543 different authors. These comments belong to 472 sub-threads and 108 threads. The trigger submission for the 108 threads were written by 61 unique authors. 150 out of the 1404 comments followed 20 submissions with opposing content relative to the subreddit's mainstream content. These opposing submission were written by 15 different authors. In total, 6 threads including 60 comments did not contain discussions on the 2020 wildfires but e.g. used the word 'fire' in a metaphorical way. They were excluded from the dataset. 

```{r}
# split waves 
data_cal <- data%>%
  filter(wave == "california")

data_aus <- data%>%
  filter(wave == "australia")
```
# Summary Statistics for different Discussion Threads

### Ausralia Data
```{r}  
options(digits = 3)

data_aus %>%  
  group_by(subreddit, opposing)%>%
  summarize(max_depth = max(max_thread_depth), mean_depth = mean(max_thread_depth),
            max_widht = max(mean_thread_width), mean_width = mean(mean_thread_width),
            max_ups = max(ups_sub), mean_ups = mean(ups_sub),
            max_comms = max(n_comments_sub), mean_coms = mean(n_comments_sub)) %>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
```

### California Data
```{r}
# create summary tables for deliberative structure estimates
data_cal %>%  
  group_by(subreddit, opposing)%>%
  summarize(max_depth = max(max_thread_depth), mean_depth = mean(max_thread_depth),
            max_widht = max(mean_thread_width), mean_width = mean(mean_thread_width),
            max_ups = max(ups_sub), mean_ups = mean(ups_sub),
            max_comms = max(n_comments_sub), mean_coms = mean(n_comments_sub)) %>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
```


## Group sizes 

Number of Comments
```{r}
data%>%
  group_by(subreddit, wave)%>%
  summarise(n())%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")

```

Number of Threads
```{r}
thread_data%>%
  group_by(subreddit, wave)%>%
  summarise(n())%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
```

# Different Width estimates

1. Mean in-degrees of comments per thread
2. Number of different users engaged in thread
3. Maximum width of thread at any given depth level

```{r}
# Mean in-degree
ggplot()+
  geom_histogram(aes(data$mean_thread_width))+
  xlab("Mean in-degrees of comments per thread")


# Unique authors
data <- data%>%
  dplyr::group_by(id_sub)%>%
  dplyr::mutate(unique_authors = n_distinct(author_c))

ggplot()+
  geom_histogram(aes(data$unique_authors))+
  xlab("Number of unique authors engaged in thread")


# Maximum width (number of comments) on a given depth level
data <- data%>%
  group_by(id_sub, depth_c)%>%
  mutate(width_values = sum(in_degree_com))%>%
  group_by(id_sub)%>%
  mutate(gonzalez_width = max(width_values))

ggplot()+
  geom_histogram(aes(data$gonzalez_width))+
  xlab("Maximum width of thread at any given depth level")

```


# Summary statistics - comment level 

```{r}
# drop NAs
data <- data.frame(na.omit(data)) ### impute NAs to keep full sample??
```

One node represents one comment, in-degrees represent indegrees of comments (how many replies did one comment get), ups refer to comments (how many ups did one comment get)

```{r}

# plot in_degree distributions

ggplot(data, aes(n_comments_sub, mean_thread_width))+
  geom_point(aes(colour = as.factor(opposing), size = ups_sub), 
             position = position_jitter(width = 10, height = 0.08),
             alpha = 0.5)+
  geom_point(data = subset(data, opposing == 1), aes(colour = as.factor(opposing), size = ups_sub), 
             position = position_jitter(width = 10, height = 0.08),
             alpha = 0.5)+
  theme_minimal()+
  facet_grid(vars(wave), vars(subreddit))+
  xlab("Number of Comments")+
  ylab("Width (in-degree)")+
  scale_colour_manual(name="Type",
                        labels=c("congruent", "opposing"),
                        values=c("#2E8B57", "indianred")) +
  scale_size_continuous(name="Up-votes")
  
  
```

```{r}
# plot in_degree distributions

ggplot(data, aes(max_thread_depth, mean_thread_width))+
  geom_point(aes(colour = as.factor(opposing), size = ups_sub), 
             position = position_jitter(width = 6, height = 0.08),
             alpha = 0.5)+
  geom_point(data = subset(data, opposing == 1), aes(colour = as.factor(opposing), size = ups_sub), 
             position = position_jitter(width = 6, height = 0.08),
             alpha = 0.5)+
  theme_minimal()+
  facet_grid(vars(wave), vars(subreddit))+
  xlab("Depth")+
  ylab("Width (in-degree)")+
  scale_colour_manual(name="Type",
                        labels=c("congruent", "opposing"),
                        values=c("#2E8B57", "indianred")) +
  scale_size_continuous(name="Up-votes")

```

```{r}

ggplot(data, aes(max_thread_depth, mean_thread_width))+
  geom_point(aes(colour = as.factor(opposing), size = n_comments_sub), 
             #position = position_jitter(width = 3, height = 0.08),
             alpha = 0.5)+
  geom_point(data = subset(data, opposing == 1), 
             aes(colour = as.factor(opposing), size = ups_sub), 
             äposition = position_jitter(width = 3, height = 0.08),
             alpha = 0.5)+
  #theme_grey()+
  facet_grid(vars(wave), vars(subreddit))+
  xlab("Depth")+
  ylab("Width (in-degree)")+
  scale_colour_manual(name="Type",
                        labels=c("congruent", "opposing"),
                        values=c("#2E8B57", "indianred")) +
  scale_size_continuous(name="N comments")

```


# Hpyotheses Tests

## H1: Threads in reaction to opposing views have lower scores.

```{r, fig.show="hold", out.width="50%"}
par(mar = c(4, 4, .1, .1))

# comment level data

data$opposing <- as.factor(data$opposing)

my.mean<-tapply(data[,"ups_sub"],data[,"opposing"],mean, na.rm =T)
my.sd<-tapply(data[,"ups_sub"],data[,"opposing"],sd)
my.nr<-as.vector(table(data[,"opposing"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("congruent","opposing")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("indianred")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=15),
    axis.title.y = element_text( colour="black", size=15))+
  labs(x="",y="mean up-votes of submissions",title="Comment level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

# thread level data

thread_data <- data.frame(thread_data)

thread_data$opposing <- as.factor(thread_data$opposing)

my.mean<-tapply(thread_data[,"ups_sub"],thread_data[,"opposing"],mean, na.rm =T)
my.sd<-tapply(thread_data[,"ups_sub"],thread_data[,"opposing"],sd)
my.nr<-as.vector(table(thread_data[,"opposing"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("congruent","opposing")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("indianred")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=15),
    axis.title.y = element_text( colour="black", size=15))+
  labs(x="",y="mean up-votes of submissions", title="Thread level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

```
```{r}
# thread level data + grouped for subreddits

thread_data <- data.frame(thread_data)
thread_data$opposing <- as.factor(thread_data$opposing)

df <- thread_data %>% 
  group_by(subreddit, wave, opposing)%>%
  summarise(se = sd(ups_sub)/sqrt(length(ups_sub)),
                     mean = mean(ups_sub))

df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")

ggplot(df, aes(x=opposing, y=mean, fill = subreddit)) +
  geom_bar(position=position_dodge(), stat="identity", colour='white') +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1,position=position_dodge(.9))+
  theme_minimal()+
  scale_fill_manual(values=c("indianred2", "indianred4"))+
  labs(x="opposing submission content",y="mean up-votes of submissions", title="Thread level data")+
  facet_grid(vars(wave))

```

T-Test for opposing vs. congruent submissions
```{r}
# overall t-test
t.test(thread_data$ups_sub ~ thread_data$opposing)

```
ANOVA for opposing vs. congruent x wave 
```{r}
# overall t-test
summary(aov(ups_sub ~ opposing + wave + opposing * wave, data = thread_data))
```
ANOVA for opposing vs. congruent x ideology (subreddit) 
```{r}
# overall t-test
summary(aov(ups_sub ~ opposing + subreddit + opposing * subreddit, data = thread_data))
```
3-way ANOVA for opposing vs. congruent x ideology (subreddit) x wave
```{r}
# overall t-test
summary(aov(ups_sub ~ opposing + subreddit + wave + opposing * subreddit + opposing * wave + subreddit * wave + 
              subreddit * opposing * wave, data = thread_data))
```

## H2: Threads in reaction to opposing views have higher number of comments.

```{r, fig.show="hold", out.width="50%"}

par(mar = c(4, 4, .1, .1))
# comment level data

data$opposing <- as.factor(data$opposing)

my.mean<-tapply(data[,"n_comments_sub"],data[,"opposing"],mean, na.rm =T)
my.sd<-tapply(data[,"n_comments_sub"],data[,"opposing"],sd)
my.nr<-as.vector(table(data[,"opposing"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("congruent","opposing")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("goldenrod")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="mean number of comments to submissions",title="Comment level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)


# thread level data

thread_data <- data.frame(thread_data)

thread_data$opposing <- as.factor(thread_data$opposing)

my.mean<-tapply(thread_data[,"n_comments_sub"],thread_data[,"opposing"],mean, na.rm =T)
my.sd<-tapply(thread_data[,"n_comments_sub"],thread_data[,"opposing"],sd)
my.nr<-as.vector(table(thread_data[,"opposing"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("congruent","opposing")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("goldenrod")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="mean number of comments to submissions", title="Thread level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

```
```{r}
# thread level data + grouped for subreddits

thread_data <- data.frame(thread_data)
thread_data$opposing <- as.factor(thread_data$opposing)

df <- thread_data %>% 
  group_by(subreddit, wave, opposing)%>%
  summarise(se = sd(n_comments_sub)/sqrt(length(n_comments_sub)),
                     mean = mean(n_comments_sub))

df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")

ggplot(df, aes(x=opposing, y=mean, fill = subreddit)) +
  geom_bar(position=position_dodge(), stat="identity", colour='white') +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1,position=position_dodge(.9))+
  theme_minimal()+
  scale_fill_manual(values=c("goldenrod", "gold"))+
  labs(x="opposing submission content",y="mean number of comments to submissions", title="Thread level data")+
  facet_grid(vars(wave))

```


## H3: Threads in reaction to opposing views are deeper. 

```{r, fig.show="hold", out.width="50%"}

par(mar = c(4, 4, .1, .1))
# comment level data

data$opposing <- as.factor(data$opposing)

my.mean<-tapply(data[,"max_thread_depth"],data[,"opposing"],mean, na.rm =T)
my.sd<-tapply(data[,"max_thread_depth"],data[,"opposing"],sd)
my.nr<-as.vector(table(data[,"opposing"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("congruent","opposing")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("skyblue")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="maximum depth of threads",title="Comment level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

# thread level data

thread_data <- data.frame(thread_data)

thread_data$opposing <- as.factor(thread_data$opposing)

my.mean<-tapply(thread_data[,"max_thread_depth"],thread_data[,"opposing"],mean, na.rm =T)
my.sd<-tapply(thread_data[,"max_thread_depth"],thread_data[,"opposing"],sd)
my.nr<-as.vector(table(thread_data[,"opposing"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("congruent","opposing")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("skyblue")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="maximum depth of threads", title="Thread level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

```
```{r}
# thread level data + grouped for subreddits

thread_data <- data.frame(thread_data)
thread_data$opposing <- as.factor(thread_data$opposing)

df <- thread_data %>% 
  group_by(subreddit, wave, opposing)%>%
  summarise(se = sd(max_thread_depth)/sqrt(length(max_thread_depth)),
                     mean = mean(max_thread_depth))

df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")

ggplot(df, aes(x=opposing, y=mean, fill = subreddit)) +
  geom_bar(position=position_dodge(), stat="identity", colour='white') +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1,position=position_dodge(.9))+
  theme_minimal()+
  scale_fill_manual(values=c("skyblue", "slateblue"))+
  labs(x="opposing submission content",y="maximum depth of threads", title="Thread level data")+
  facet_grid(vars(wave))

```

T-Test for opposing vs. congruent submissions
```{r}
# overall t-test
t.test(thread_data$max_thread_depth ~ thread_data$opposing)

```
ANOVA for opposing vs. congruent x wave 
```{r}
summary(aov(max_thread_depth ~ opposing + wave + opposing * wave, data = thread_data))
```
ANOVA for opposing vs. congruent x ideology (subreddit) 
```{r}
summary(aov(max_thread_depth ~ opposing + subreddit + opposing * subreddit, data = thread_data))
```
3-way ANOVA for opposing vs. congruent x ideology (subreddit) x wave
```{r}
summary(aov(max_thread_depth ~ opposing + subreddit + wave + opposing * subreddit + opposing * wave + subreddit * wave + 
              subreddit * opposing * wave, data = thread_data))
```

## H4: Threads in reaction to congruent views are wider.  

```{r, fig.show="hold", out.width="50%"}

par(mar = c(4, 4, .1, .1))
# comment level data

data$opposing <- as.factor(data$opposing)

my.mean<-tapply(data[,"mean_thread_width"],data[,"opposing"],mean, na.rm =T)
my.sd<-tapply(data[,"mean_thread_width"],data[,"opposing"],sd)
my.nr<-as.vector(table(data[,"opposing"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("congruent","opposing")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("steelblue")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="mean widdth of threads",title="Comment level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

# thread level data

thread_data <- data.frame(thread_data)

thread_data$opposing <- as.factor(thread_data$opposing)

my.mean<-tapply(thread_data[,"mean_thread_width"],thread_data[,"opposing"],mean, na.rm =T)
my.sd<-tapply(thread_data[,"mean_thread_width"],thread_data[,"opposing"],sd)
my.nr<-as.vector(table(thread_data[,"opposing"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("congruent","opposing")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("steelblue")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="mean widdth of threads", title="Thread level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

```
```{r}
# thread level data + grouped for subreddits

thread_data <- data.frame(thread_data)
thread_data$opposing <- as.factor(thread_data$opposing)

df <- thread_data %>% 
  group_by(subreddit, wave, opposing)%>%
  summarise(se = sd(mean_thread_width)/sqrt(length(mean_thread_width)),
                     mean = mean(mean_thread_width))

df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")

ggplot(df, aes(x=opposing, y=mean, fill = subreddit)) +
  geom_bar(position=position_dodge(), stat="identity", colour='white') +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1,position=position_dodge(.9))+
  theme_minimal()+
  scale_fill_manual(values=c("steelblue2", "steelblue4"))+
  labs(x="opposing submission content",y="mean widdth of threads", title="Thread level data")+
  facet_grid(vars(wave))

```


# Deliberative Structure

Creating measure for further analyses / comparison with deliberative quality: **deliberative structure**.
mean_width x max_depth

```{r}
data <- data%>%
  mutate(del_structure = max_thread_depth*mean_thread_width)

```

```{r, fig.show="hold", out.width="50%"}

par(mar = c(4, 4, .1, .1))
# comment level data

my.mean<-tapply(data[,"del_structure"],data[,"opposing"],mean, na.rm =T)
my.sd<-tapply(data[,"del_structure"],data[,"opposing"],sd)
my.nr<-as.vector(table(data[,"opposing"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("congruent","opposing")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("seagreen")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="deliberative structure of threads",title="Comment level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

# thread level data
thread_data <- data %>% 
  group_by(id_sub) %>% slice(1)

thread_data <- data.frame(thread_data)

my.mean<-tapply(thread_data[,"del_structure"],thread_data[,"opposing"],mean, na.rm =T)
my.sd<-tapply(thread_data[,"del_structure"],thread_data[,"opposing"],sd)
my.nr<-as.vector(table(thread_data[,"opposing"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("congruent","opposing")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("seagreen")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="deliberative structure of threads", title="Thread level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

```
```{r}
# thread level data + grouped for subreddits

df <- thread_data %>% 
  group_by(subreddit, wave, opposing)%>%
  summarise(se = sd(del_structure)/sqrt(length(del_structure)),
                     mean = mean(del_structure))

df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")

ggplot(df, aes(x=opposing, y=mean, fill = subreddit)) +
  geom_bar(position=position_dodge(), stat="identity", colour='white') +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1,position=position_dodge(.9))+
  theme_minimal()+
  scale_fill_manual(values=c("seagreen", "seagreen3"))+
  labs(x="opposing submission content",y="deliberative structure of threads", title="Thread   level data")+
  facet_grid(vars(wave))

```

T-Test for opposing vs. congruent submissions
```{r}
# overall t-test
t.test(thread_data$del_structure ~ thread_data$opposing)

```
ANOVA for opposing vs. congruent x wave 
```{r}
summary(aov(del_structure ~ opposing + wave + opposing * wave, data = thread_data))
```
ANOVA for opposing vs. congruent x ideology (subreddit) 
```{r}
summary(aov(del_structure ~ opposing + subreddit + opposing * subreddit, data = thread_data))
```
3-way ANOVA for opposing vs. congruent x ideology (subreddit) x wave
```{r}
summary(aov(del_structure ~ opposing + subreddit + wave + opposing * subreddit + opposing * wave + subreddit * wave + 
              subreddit * opposing * wave, data = thread_data))
```


## Further Ideas

Alternative Measure for width (representation) --> number of unique users involved

```{r}
ggplot(data, aes(max_thread_depth, unique_authors))+
  geom_point(aes(colour = as.factor(opposing), size = n_comments_sub), 
             position = position_jitter(width = 2, height = 5),
             alpha = 0.5)+
  geom_point(data = subset(data, opposing == 1), 
             aes(colour = as.factor(opposing), size = ups_sub), 
             position = position_jitter(width = 2, height = 5),
             alpha = 0.5)+
  #theme_grey()+
  facet_grid(vars(wave), vars(subreddit))+
  xlab("Depth")+
  ylab("Width (engaged users)")+
  scale_colour_manual(name="Type",
                        labels=c("congruent", "opposing"),
                        values=c("#2E8B57", "indianred")) +
  scale_size_continuous(name="N comments")

``` 


```{r, fig.show="hold", out.width="50%"}

par(mar = c(4, 4, .1, .1))
# comment level data

my.mean<-tapply(data[,"unique_authors"],data[,"opposing"],mean, na.rm =T)
my.sd<-tapply(data[,"unique_authors"],data[,"opposing"],sd)
my.nr<-as.vector(table(data[,"opposing"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("congruent","opposing")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("steelblue")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="Number of different authors involved in threads",title="Comment level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

# thread level data
thread_data <- data %>% 
  group_by(id_sub) %>% slice(1)

thread_data <- data.frame(thread_data)

my.mean<-tapply(thread_data[,"unique_authors"],thread_data[,"opposing"],mean, na.rm =T)
my.sd<-tapply(thread_data[,"unique_authors"],thread_data[,"opposing"],sd)
my.nr<-as.vector(table(thread_data[,"opposing"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("congruent","opposing")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("steelblue")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="Authors involved in threads", title="Thread level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

```
```{r}
# thread level data + grouped for subreddits

df <- thread_data %>% 
  group_by(subreddit, wave, opposing)%>%
  summarise(se = sd(unique_authors)/sqrt(length(unique_authors)),
                     mean = mean(unique_authors))

df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")

ggplot(df, aes(x=opposing, y=mean, fill = subreddit)) +
  geom_bar(position=position_dodge(), stat="identity", colour='white') +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1,position=position_dodge(.9))+
  theme_minimal()+
  scale_fill_manual(values=c("steelblue4", "steelblue2"))+
  labs(x="opposing submission content",y="Authors involved in threads", title="Thread level data")+
  facet_grid(vars(wave))

```

T-Test for opposing vs. congruent submissions
```{r}
# overall t-test
t.test(thread_data$unique_authors ~ thread_data$opposing)

```
ANOVA for opposing vs. congruent x wave 
```{r}
summary(aov(unique_authors ~ opposing + wave + opposing * wave, data = thread_data))
```
ANOVA for opposing vs. congruent x ideology (subreddit) 
```{r}
summary(aov(unique_authors ~ opposing + subreddit + opposing * subreddit, data = thread_data))
```
3-way ANOVA for opposing vs. congruent x ideology (subreddit) x wave
```{r}
summary(aov(unique_authors ~ opposing + subreddit + wave + opposing * subreddit + opposing * wave + subreddit * wave + 
              subreddit * opposing * wave, data = thread_data))
```

# Deliberative Structure / Complexity --> Users 

Creating measure for further analyses / comparison with deliberative quality: **deliberative structure**.
unique_authors x max_depth

```{r}
data <- data%>%
  mutate(del_complexity = max_thread_depth*unique_authors)

thread_data <- data %>% 
  group_by(id_sub) %>% slice(1)

thread_data <- data.frame(thread_data)


```

```{r, fig.show="hold", out.width="50%"}

par(mar = c(4, 4, .1, .1))
# comment level data

my.mean<-tapply(data[,"del_complexity"],data[,"subreddit"],mean, na.rm =T)
my.sd<-tapply(data[,"del_complexity"],data[,"subreddit"],sd)
my.nr<-as.vector(table(data[,"subreddit"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("climate change","climate skeptics")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("steelblue")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="deliberative complexity of threads",title="Comment level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

# thread level data

my.mean<-tapply(thread_data[,"del_complexity"],thread_data[,"subreddit"],mean, na.rm =T)
my.sd<-tapply(thread_data[,"del_complexity"],thread_data[,"subreddit"],sd)
my.nr<-as.vector(table(thread_data[,"subreddit"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("climate change","climate skeptics")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("steelblue3")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="deliberative complexity of threads", title="Thread level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

```
```{r}
# thread level data + grouped for subreddits

df <- thread_data %>% 
  dplyr::group_by(subreddit, wave, opposing)%>%
  dplyr::summarise(se = sd(del_complexity)/sqrt(length(del_complexity)),
                     mean = mean(del_complexity))

df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")

ggplot(df, aes(x=opposing, y=mean, fill = subreddit)) +
  geom_bar(position=position_dodge(), stat="identity", colour='white') +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1,position=position_dodge(.9))+
  theme_minimal()+
  scale_fill_manual(values=c("seagreen", "seagreen3"))+
  labs(x="opposing submission content",y="deliberative complexity of threads", title="Thread level data")+
  facet_grid(vars(wave))

```

T-Test for opposing vs. congruent submissions
```{r}
# overall t-test
t.test(thread_data$del_complexity ~ thread_data$opposing)

```
ANOVA for opposing vs. congruent x wave 
```{r}
summary(aov(del_complexity ~ opposing + wave + opposing * wave, data = thread_data))
```
ANOVA for opposing vs. congruent x ideology (subreddit) 
```{r}
summary(aov(del_complexity ~ opposing + subreddit + opposing * subreddit, data = thread_data))
```
3-way ANOVA for opposing vs. congruent x ideology (subreddit) x wave
```{r}
summary(aov(del_complexity ~ opposing + subreddit + wave + opposing * subreddit + opposing * wave + subreddit * wave + 
              subreddit * opposing * wave, data = thread_data))
```

# Gonzalez Width

```{r}
ggplot(data, aes(max_thread_depth, gonzalez_width))+
  geom_point(aes(colour = as.factor(opposing), size = n_comments_sub), 
             position = position_jitter(width = 2, height = 5),
             alpha = 0.5)+
  geom_point(data = subset(data, opposing == 1), 
             aes(colour = as.factor(opposing), size = ups_sub), 
             position = position_jitter(width = 2, height = 5),
             alpha = 0.5)+
  #theme_grey()+
  facet_grid(vars(wave), vars(subreddit))+
  xlab("Depth")+
  ylab("Width (Gonzalez-Bailon, 2010)")+
  scale_colour_manual(name="Type",
                        labels=c("congruent", "opposing"),
                        values=c("#2E8B57", "indianred")) +
  scale_size_continuous(name="N comments")

``` 


```{r, fig.show="hold", out.width="50%"}

par(mar = c(4, 4, .1, .1))
# comment level data

my.mean<-tapply(data[,"gonzalez_width"],data[,"opposing"],mean, na.rm =T)
my.sd<-tapply(data[,"gonzalez_width"],data[,"opposing"],sd)
my.nr<-as.vector(table(data[,"opposing"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("congruent","opposing")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("steelblue")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="Maximum width of comment thread at any given depth",title="Comment level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

# thread level data
thread_data <- data %>% 
  group_by(id_sub) %>% slice(1)

thread_data <- data.frame(thread_data)

my.mean<-tapply(thread_data[,"gonzalez_width"],thread_data[,"opposing"],mean, na.rm =T)
my.sd<-tapply(thread_data[,"gonzalez_width"],thread_data[,"opposing"],sd)
my.nr<-as.vector(table(thread_data[,"opposing"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("congruent","opposing")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("steelblue")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="Maximum width of comment thread at any given depth", title="Thread level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

```
```{r}
# thread level data + grouped for subreddits

df <- thread_data %>% 
  group_by(subreddit, wave, opposing)%>%
  summarise(se = sd(gonzalez_width)/sqrt(length(gonzalez_width)),
                     mean = mean(gonzalez_width))

df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")

ggplot(df, aes(x=opposing, y=mean, fill = subreddit)) +
  geom_bar(position=position_dodge(), stat="identity", colour='white') +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1,position=position_dodge(.9))+
  theme_minimal()+
  scale_fill_manual(values=c("steelblue4", "steelblue2"))+
  labs(x="opposing submission content",y="G Width of threads", title="Thread level data")+
  facet_grid(vars(wave))

```

T-Test for opposing vs. congruent submissions
```{r}
# overall t-test
t.test(thread_data$gonzalez_width ~ thread_data$opposing)

```
ANOVA for opposing vs. congruent x wave 
```{r}
summary(aov(gonzalez_width ~ opposing + wave + opposing * wave, data = thread_data))
```
ANOVA for opposing vs. congruent x ideology (subreddit) 
```{r}
summary(aov(gonzalez_width ~ opposing + subreddit + opposing * subreddit, data = thread_data))
```
3-way ANOVA for opposing vs. congruent x ideology (subreddit) x wave
```{r}
summary(aov(gonzalez_width ~ opposing + subreddit + wave + opposing * subreddit + opposing * wave + subreddit * wave + 
              subreddit * opposing * wave, data = thread_data))
```

# Deliberative Structure / Complexity --> Gonzalez Width 

Creating measure for further analyses / comparison with deliberative quality: **deliberative structure**.
gonzalez_width x max_depth

```{r}
data <- data%>%
  mutate(del_complexity = max_thread_depth*gonzalez_width)

thread_data <- data %>% 
  group_by(id_sub) %>% slice(1)

thread_data <- data.frame(thread_data)

ggplot(data, aes(max_thread_depth, gonzalez_width))+
  geom_point(aes(colour = as.factor(opposing), size = n_comments_sub), 
             position = position_jitter(width = 3, height = 3),
             alpha = 0.5)+
  geom_point(data = subset(data, opposing == 1), aes(colour = as.factor(opposing), size = ups_sub), 
             position = position_jitter(width = 6, height = 0.08),
             alpha = 0.5)+
  theme_minimal()+
  facet_grid(vars(wave), vars(subreddit))+
  xlab("Depth")+
  ylab("Width")+
  scale_colour_manual(name="Type",
                        labels=c("congruent", "opposing"),
                        values=c("#2E8B57", "indianred")) +
  scale_size_continuous(name="Number of Comments")

ggsave(file="G_width_depth.png",width = 8, height = 6, dpi = 500)

```

```{r, fig.show="hold", out.width="50%"}

par(mar = c(4, 4, .1, .1))
# comment level data

my.mean<-tapply(data[,"del_complexity"],data[,"subreddit"],mean, na.rm =T)
my.sd<-tapply(data[,"del_complexity"],data[,"subreddit"],sd)
my.nr<-as.vector(table(data[,"subreddit"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("climate change","climate skeptics")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("steelblue")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="deliberative complexity of threads",title="Comment level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

# thread level data

my.mean<-tapply(thread_data[,"del_complexity"],thread_data[,"subreddit"],mean, na.rm =T)
my.sd<-tapply(thread_data[,"del_complexity"],thread_data[,"subreddit"],sd)
my.nr<-as.vector(table(thread_data[,"subreddit"]))
my.se<-my.sd/sqrt(my.nr)

my.df<-data.frame(groups=factor(names(my.mean),labels =c("climate change","climate skeptics")),
                   mean=my.mean,
                   sd=my.sd,
                   se=my.se)

my.df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")
  
ggplot(my.df, aes(x=groups, y=mean)) + 
  geom_bar(stat="identity", aes(x=groups, y=mean),size=0.1,
           width = 0.6, fill=c("steelblue3")) + 
  theme(
    axis.text.x = element_text(colour="black", size =12),
    axis.text.y = element_text(colour="black", size =10), 
    axis.title.x = element_text( colour="black", size=12),
    axis.title.y = element_text( colour="black", size=12))+
  labs(x="",y="deliberative complexity of threads", title="Thread level data")+
  geom_errorbar(aes(ymin = mean-my.se, ymax = mean+my.se), width=.1)

```
```{r}
# thread level data + grouped for subreddits

df <- thread_data %>% 
  dplyr::group_by(subreddit, wave, opposing)%>%
  dplyr::summarise(se = sd(del_complexity)/sqrt(length(del_complexity)),
                     mean = mean(del_complexity))

df%>%
  xtable()%>%
  kable()%>% 
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE,
                position = "center")

ggplot(df, aes(x=opposing, y=mean, fill = subreddit)) +
  geom_bar(position=position_dodge(), stat="identity", colour='white') +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1,position=position_dodge(.9))+
  theme_minimal()+
  scale_fill_manual(values=c("seagreen", "seagreen3"))+
  labs(x="opposing submission content",y="deliberative complexity of threads", title="Thread level data")+
  facet_grid(vars(wave))

```

T-Test for opposing vs. congruent submissions
```{r}
# overall t-test
t.test(thread_data$del_complexity ~ thread_data$opposing)

```
ANOVA for opposing vs. congruent x wave 
```{r}
summary(aov(del_complexity ~ opposing + wave + opposing * wave, data = thread_data))
```
ANOVA for opposing vs. congruent x ideology (subreddit) 
```{r}
summary(aov(del_complexity ~ opposing + subreddit + opposing * subreddit, data = thread_data))
```
3-way ANOVA for opposing vs. congruent x ideology (subreddit) x wave
```{r}
summary(aov(del_complexity ~ opposing + subreddit + wave + opposing * subreddit + opposing * wave + subreddit * wave + 
              subreddit * opposing * wave, data = thread_data))
```




